<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>个性化导航页（云同步版）</title>
  <!-- 引入外部资源 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- Firebase SDK (使用模块化版本，与你的配置匹配) -->
  <script type="module">
    // 导入Firebase模块
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-analytics.js";

    // 你的Firebase配置
    const firebaseConfig = {
      apiKey: "AIzaSyChDHy10Fvwx-ZWzKqwn8kt_E--16QvORw",
      authDomain: "mynavlinks.firebaseapp.com",
      projectId: "mynavlinks",
      storageBucket: "mynavlinks.firebasestorage.app",
      messagingSenderId: "846703654591",
      appId: "1:846703654591:web:27cc8742565f9ce872780a",
      measurementId: "G-0E20HZRHMZ"
    };

    // 初始化Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    
    // 导出Firebase服务供全局使用
    window.firebase = {
      auth: getAuth(app),
      firestore: getFirestore(app)
    };

    // 初始化应用（确保Firebase加载完成后执行）
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
  
  <!-- 配置Tailwind -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#4F46E5',
            secondary: '#10B981',
            dark: '#1E293B',
            light: '#F8FAFC'
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-hover {
        @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
      }
      .btn-primary {
        @apply bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-all;
      }
      .btn-secondary {
        @apply bg-secondary text-white px-4 py-2 rounded-lg hover:bg-secondary/90 transition-all;
      }
      .input-field {
        @apply w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50;
      }
    }
  </style>
</head>
<body class="font-inter bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen text-dark">
  <!-- 顶部导航栏 -->
  <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50 transition-all duration-300">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-primary flex items-center gap-2">
        <i class="fa fa-compass"></i>
        <span>导航中心</span>
      </h1>
      
      <div class="flex items-center gap-3">
        <button id="toggleTheme" class="p-2 rounded-full hover:bg-gray-100 transition-all">
          <i class="fa fa-moon-o"></i>
        </button>
        <button id="addLinkBtn" class="btn-primary flex items-center gap-1 hidden">
          <i class="fa fa-plus"></i>
          <span>添加链接</span>
        </button>
        <button id="userBtn" class="btn-secondary flex items-center gap-1">
          <i class="fa fa-user"></i>
          <span>登录</span>
        </button>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8">
    <!-- 搜索框 -->
    <div class="max-w-2xl mx-auto mb-10 hidden" id="searchContainer">
      <div class="relative">
        <input 
          type="text" 
          id="searchInput" 
          placeholder="搜索链接..." 
          class="input-field py-3 pl-10 pr-4 text-lg"
        >
        <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
      </div>
    </div>

    <!-- 分类标签 -->
    <div class="flex flex-wrap gap-2 mb-6 overflow-x-auto pb-2 hidden" id="categoriesContainer">
      <button class="category-btn bg-primary text-white px-4 py-2 rounded-full text-sm active" data-category="all">
        全部
      </button>
      <!-- 分类会通过JS动态添加 -->
    </div>

    <!-- 链接容器 -->
    <div id="linksContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
      <!-- 初始状态：提示登录 -->
      <div class="col-span-full flex flex-col items-center justify-center py-16 text-gray-500">
        <i class="fa fa-user-circle text-5xl mb-4 opacity-30"></i>
        <p class="text-lg">请登录以同步你的链接</p>
        <button id="loginPromptBtn" class="mt-4 btn-primary">立即登录</button>
      </div>
    </div>
  </main>

  <!-- 添加/编辑链接模态框 -->
  <div id="linkModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6 transform transition-all scale-95 opacity-0" id="modalContent">
      <div class="flex justify-between items-center mb-4">
        <h2 id="modalTitle" class="text-xl font-bold">添加新链接</h2>
        <button id="closeModal" class="text-gray-500 hover:text-gray-700">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      
      <form id="linkForm">
        <input type="hidden" id="linkId">
        
        <div class="mb-4">
          <label for="linkName" class="block text-sm font-medium text-gray-700 mb-1">名称</label>
          <input type="text" id="linkName" class="input-field" required placeholder="例如：GitHub">
        </div>
        
        <div class="mb-4">
          <label for="linkUrl" class="block text-sm font-medium text-gray-700 mb-1">网址</label>
          <input type="url" id="linkUrl" class="input-field" required placeholder="例如：https://github.com">
        </div>
        
        <div class="mb-4">
          <label for="linkCategory" class="block text-sm font-medium text-gray-700 mb-1">分类</label>
          <input type="text" id="linkCategory" class="input-field" placeholder="例如：开发工具（可选）">
        </div>
        
        <div class="mb-6">
          <label for="linkIcon" class="block text-sm font-medium text-gray-700 mb-1">图标</label>
          <div class="flex gap-2">
            <input type="text" id="linkIcon" class="input-field" placeholder="Font Awesome类名，例如：fa-github">
            <div class="flex items-center justify-center w-12 h-10 border border-gray-300 rounded-lg bg-gray-50">
              <i id="iconPreview" class="fa fa-link text-gray-400"></i>
            </div>
          </div>
          <p class="text-xs text-gray-500 mt-1">可在<a href="https://fontawesome.com/v4/icons/" target="_blank" class="text-primary">Font Awesome</a>查找图标类名</p>
        </div>
        
        <div class="flex gap-3">
          <button type="button" id="cancelBtn" class="flex-1 border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 transition-all">
            取消
          </button>
          <button type="submit" class="flex-1 btn-primary">
            保存
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- 登录/注册模态框 -->
  <div id="authModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6 transform transition-all scale-95 opacity-0" id="authModalContent">
      <div class="flex justify-between items-center mb-4">
        <h2 id="authModalTitle" class="text-xl font-bold">用户登录</h2>
        <button id="closeAuthModal" class="text-gray-500 hover:text-gray-700">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      
      <form id="authForm">
        <div class="mb-4">
          <label for="authEmail" class="block text-sm font-medium text-gray-700 mb-1">邮箱</label>
          <input type="email" id="authEmail" class="input-field" required placeholder="your@email.com">
        </div>
        
        <div class="mb-6">
          <label for="authPassword" class="block text-sm font-medium text-gray-700 mb-1">密码</label>
          <input type="password" id="authPassword" class="input-field" required placeholder="至少6位字符">
        </div>
        
        <div class="flex gap-3 mb-4">
          <button type="button" id="switchAuthMode" class="flex-1 border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 transition-all">
            切换到注册
          </button>
          <button type="submit" class="flex-1 btn-secondary">
            登录
          </button>
        </div>
        
        <p class="text-xs text-gray-500 text-center">
          注册即表示同意存储你的链接数据用于同步功能
        </p>
      </form>
    </div>
  </div>

  <script>
    // === 数据管理（云同步版，使用模块化Firebase API） ===
    const LinkManager = {
      // 获取Firebase服务引用
      getAuth() {
        return window.firebase.auth;
      },
      
      getFirestore() {
        return window.firebase.firestore;
      },
      
      // 获取当前登录用户
      getCurrentUser() {
        return this.getAuth().currentUser;
      },
      
      // 登录
      async login(email, password) {
        const { signInWithEmailAndPassword } = await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js");
        return await signInWithEmailAndPassword(this.getAuth(), email, password);
      },
      
      // 注册
      async register(email, password) {
        const { createUserWithEmailAndPassword } = await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js");
        return await createUserWithEmailAndPassword(this.getAuth(), email, password);
      },
      
      // 登出
      async logout() {
        const { signOut } = await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js");
        return await signOut(this.getAuth());
      },
      
      // 获取用户的链接（从云端）
      async getLinks() {
        const user = this.getCurrentUser();
        if (!user) return [];
        
        const { collection, getDocs, orderBy } = await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js");
        const linksCol = collection(
          this.getFirestore(), 
          'users', 
          user.uid, 
          'links'
        );
        const q = orderBy(linksCol, 'name');
        const linksSnapshot = await getDocs(q);
        
        return linksSnapshot.docs.map(doc => ({
          id: doc.id,
          ...doc.data()
        }));
      },
      
      // 添加新链接
      async addLink(link) {
        const user = this.getCurrentUser();
        if (!user) return null;
        
        const { collection, addDoc } = await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js");
        link.id = Date.now().toString(); // 使用时间戳作为ID
        
        await addDoc(
          collection(this.getFirestore(), 'users', user.uid, 'links'),
          link
        );
        
        return link;
      },
      
      // 更新链接
      async updateLink(updatedLink) {
        const user = this.getCurrentUser();
        if (!user) return null;
        
        const { doc, setDoc } = await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js");
        await setDoc(
          doc(this.getFirestore(), 'users', user.uid, 'links', updatedLink.id),
          updatedLink
        );
        
        return updatedLink;
      },
      
      // 删除链接
      async deleteLink(id) {
        const user = this.getCurrentUser();
        if (!user) return [];
        
        const { doc, deleteDoc } = await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js");
        await deleteDoc(
          doc(this.getFirestore(), 'users', user.uid, 'links', id)
        );
        
        return this.getLinks(); // 返回删除后的列表
      },
      
      // 获取所有分类
      async getCategories() {
        const links = await this.getLinks();
        const categories = new Set();
        
        links.forEach(link => {
          if (link.category) categories.add(link.category);
        });
        
        return Array.from(categories);
      },
      
      // 按分类筛选链接
      async getLinksByCategory(category) {
        const links = await this.getLinks();
        return category === 'all' ? links : links.filter(link => link.category === category);
      }
    };

    // === DOM操作管理 ===
    const DOMManager = {
      // 渲染所有链接
      async renderLinks(category = 'all') {
        const linksContainer = document.getElementById('linksContainer');
        const links = await LinkManager.getLinksByCategory(category);
        
        if (links.length === 0) {
          linksContainer.innerHTML = `
            <div class="col-span-full flex flex-col items-center justify-center py-16 text-gray-500">
              <i class="fa fa-link text-5xl mb-4 opacity-30"></i>
              <p class="text-lg">还没有添加链接</p>
              <p class="text-sm mt-2">点击"添加链接"按钮开始</p>
            </div>
          `;
          return;
        }
        
        linksContainer.innerHTML = '';
        
        links.forEach(link => {
          const linkCard = document.createElement('div');
          linkCard.className = 'bg-white rounded-xl shadow-sm p-4 card-hover border border-gray-100 group relative';
          linkCard.innerHTML = `
            <div class="flex justify-between items-start mb-3">
              <div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
                <i class="fa ${link.icon || 'fa-link'}"></i>
              </div>
              <div class="link-actions opacity-0 group-hover:opacity-100 transition-opacity">
                <button class="edit-link p-1 text-gray-400 hover:text-primary" data-id="${link.id}">
                  <i class="fa fa-pencil"></i>
                </button>
                <button class="delete-link p-1 text-gray-400 hover:text-red-500" data-id="${link.id}">
                  <i class="fa fa-trash"></i>
                </button>
              </div>
            </div>
            <h3 class="font-medium text-gray-800 mb-1 truncate">${link.name}</h3>
            <p class="text-xs text-gray-500 mb-3 truncate">${new URL(link.url).hostname}</p>
            ${link.category ? `<span class="text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full">${link.category}</span>` : ''}
            <a href="${link.url}" target="_blank" class="absolute inset-0 w-full h-full"></a>
          `;
          
          linksContainer.appendChild(linkCard);
        });
        
        // 添加编辑和删除事件监听
        this.addLinkActionListeners();
      },
      
      // 渲染分类标签
      async renderCategories() {
        const categoriesContainer = document.getElementById('categoriesContainer');
        const categories = await LinkManager.getCategories();
        
        // 清除现有分类（保留"全部"）
        const existingCategories = categoriesContainer.querySelectorAll('.category-btn:not([data-category="all"])');
        existingCategories.forEach(cat => cat.remove());
        
        // 添加新分类
        categories.forEach(category => {
          const categoryBtn = document.createElement('button');
          categoryBtn.className = 'category-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-full text-sm hover:bg-gray-300 transition-all';
          categoryBtn.dataset.category = category;
          categoryBtn.textContent = category;
          categoriesContainer.appendChild(categoryBtn);
        });
        
        // 添加分类点击事件
        this.addCategoryListeners();
      },
      
      // 添加分类点击事件
      addCategoryListeners() {
        const categoryBtns = document.querySelectorAll('.category-btn');
        categoryBtns.forEach(btn => {
          btn.addEventListener('click', async () => {
            // 更新活跃状态
            categoryBtns.forEach(b => {
              b.classList.remove('bg-primary', 'text-white');
              b.classList.add('bg-gray-200', 'text-gray-700');
            });
            btn.classList.remove('bg-gray-200', 'text-gray-700');
            btn.classList.add('bg-primary', 'text-white');
            
            // 渲染对应分类的链接
            await this.renderLinks(btn.dataset.category);
          });
        });
      },
      
      // 添加链接操作按钮事件
      addLinkActionListeners() {
        // 编辑链接
        document.querySelectorAll('.edit-link').forEach(btn => {
          btn.addEventListener('click', async (e) => {
            e.preventDefault();
            e.stopPropagation();
            const id = btn.dataset.id;
            await this.openEditModal(id);
          });
        });
        
        // 删除链接
        document.querySelectorAll('.delete-link').forEach(btn => {
          btn.addEventListener('click', async (e) => {
            e.preventDefault();
            e.stopPropagation();
            const id = btn.dataset.id;
            if (confirm('确定要删除这个链接吗？')) {
              await LinkManager.deleteLink(id);
              const activeCategory = document.querySelector('.category-btn.bg-primary').dataset.category;
              await this.renderLinks(activeCategory);
              await this.renderCategories();
            }
          });
        });
      },
      
      // 打开添加链接模态框
      openAddModal() {
        document.getElementById('modalTitle').textContent = '添加新链接';
        document.getElementById('linkForm').reset();
        document.getElementById('linkId').value = '';
        document.getElementById('iconPreview').className = 'fa fa-link text-gray-400';
        
        this.showModal('linkModal', 'modalContent');
      },
      
      // 打开编辑链接模态框
      async openEditModal(id) {
        const links = await LinkManager.getLinks();
        const link = links.find(l => l.id === id);
        
        if (link) {
          document.getElementById('modalTitle').textContent = '编辑链接';
          document.getElementById('linkId').value = link.id;
          document.getElementById('linkName').value = link.name;
          document.getElementById('linkUrl').value = link.url;
          document.getElementById('linkCategory').value = link.category || '';
          document.getElementById('linkIcon').value = link.icon || '';
          document.getElementById('iconPreview').className = `fa ${link.icon || 'fa-link'} text-gray-400`;
          
          this.showModal('linkModal', 'modalContent');
        }
      },
      
      // 显示模态框
      showModal(modalId, contentId) {
        const modal = document.getElementById(modalId);
        const modalContent = document.getElementById(contentId);
        
        modal.classList.remove('hidden');
        // 触发动画
        setTimeout(() => {
          modalContent.classList.remove('scale-95', 'opacity-0');
          modalContent.classList.add('scale-100', 'opacity-100');
        }, 10);
      },
      
      // 隐藏模态框
      hideModal(modalId, contentId) {
        const modal = document.getElementById(modalId);
        const modalContent = document.getElementById(contentId);
        
        modalContent.classList.remove('scale-100', 'opacity-100');
        modalContent.classList.add('scale-95', 'opacity-0');
        
        // 完全隐藏模态框
        setTimeout(() => {
          modal.classList.add('hidden');
        }, 300);
      },
      
      // 切换登录/注册模式
      toggleAuthMode(isLoginMode) {
        const title = document.getElementById('authModalTitle');
        const submitBtn = document.getElementById('authForm').querySelector('button[type="submit"]');
        const switchBtn = document.getElementById('switchAuthMode');
        
        if (isLoginMode) {
          title.textContent = '用户登录';
          submitBtn.textContent = '登录';
          switchBtn.textContent = '切换到注册';
          submitBtn.dataset.mode = 'login';
        } else {
          title.textContent = '用户注册';
          submitBtn.textContent = '注册';
          switchBtn.textContent = '切换到登录';
          submitBtn.dataset.mode = 'register';
        }
      }
    };

    // === 初始化应用 ===
    async function initApp() {
      // 监听登录状态变化
      LinkManager.getAuth().onAuthStateChanged(async (user) => {
        const userBtn = document.getElementById('userBtn');
        const addLinkBtn = document.getElementById('addLinkBtn');
        const searchContainer = document.getElementById('searchContainer');
        const categoriesContainer = document.getElementById('categoriesContainer');
        
        if (user) {
          // 已登录状态
          userBtn.innerHTML = `<i class="fa fa-sign-out"></i><span>登出</span>`;
          addLinkBtn.classList.remove('hidden');
          searchContainer.classList.remove('hidden');
          categoriesContainer.classList.remove('hidden');
          
          // 加载数据
          await DOMManager.renderLinks();
          await DOMManager.renderCategories();
        } else {
          // 未登录状态
          userBtn.innerHTML = `<i class="fa fa-user"></i><span>登录</span>`;
          addLinkBtn.classList.add('hidden');
          searchContainer.classList.add('hidden');
          categoriesContainer.classList.add('hidden');
          
          // 显示登录提示
          document.getElementById('linksContainer').innerHTML = `
            <div class="col-span-full flex flex-col items-center justify-center py-16 text-gray-500">
              <i class="fa fa-user-circle text-5xl mb-4 opacity-30"></i>
              <p class="text-lg">请登录以同步你的链接</p>
              <button id="loginPromptBtn" class="mt-4 btn-primary">立即登录</button>
            </div>
          `;
          // 重新绑定登录提示按钮事件
          document.getElementById('loginPromptBtn').addEventListener('click', () => {
            DOMManager.showModal('authModal', 'authModalContent');
          });
        }
      });
      
      // 搜索功能
      document.getElementById('searchInput').addEventListener('input', async (e) => {
        const searchTerm = e.target.value.toLowerCase();
        const activeCategory = document.querySelector('.category-btn.bg-primary').dataset.category;
        const links = await LinkManager.getLinksByCategory(activeCategory);
        const linksContainer = document.getElementById('linksContainer');
        
        const filteredLinks = links.filter(link => 
          link.name.toLowerCase().includes(searchTerm) || 
          link.url.toLowerCase().includes(searchTerm) ||
          (link.category && link.category.toLowerCase().includes(searchTerm))
        );
        
        if (filteredLinks.length === 0) {
          linksContainer.innerHTML = `
            <div class="col-span-full flex flex-col items-center justify-center py-16 text-gray-500">
              <i class="fa fa-search text-5xl mb-4 opacity-30"></i>
              <p class="text-lg">没有找到匹配的链接</p>
              <p class="text-sm mt-2">尝试其他搜索词</p>
            </div>
          `;
          return;
        }
        
        linksContainer.innerHTML = '';
        
        filteredLinks.forEach(link => {
          const linkCard = document.createElement('div');
          linkCard.className = 'bg-white rounded-xl shadow-sm p-4 card-hover border border-gray-100 group relative';
          linkCard.innerHTML = `
            <div class="flex justify-between items-start mb-3">
              <div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
                <i class="fa ${link.icon || 'fa-link'}"></i>
              </div>
              <div class="link-actions opacity-0 group-hover:opacity-100 transition-opacity">
                <button class="edit-link p-1 text-gray-400 hover:text-primary" data-id="${link.id}">
                  <i class="fa fa-pencil"></i>
                </button>
                <button class="delete-link p-1 text-gray-400 hover:text-red-500" data-id="${link.id}">
                  <i class="fa fa-trash"></i>
                </button>
              </div>
            </div>
            <h3 class="font-medium text-gray-800 mb-1 truncate">${link.name}</h3>
            <p class="text-xs text-gray-500 mb-3 truncate">${new URL(link.url).hostname}</p>
            ${link.category ? `<span class="text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full">${link.category}</span>` : ''}
            <a href="${link.url}" target="_blank" class="absolute inset-0 w-full h-full"></a>
          `;
          
          linksContainer.appendChild(linkCard);
        });
        
        // 重新添加事件监听
        DOMManager.addLinkActionListeners();
      });
      
      // 图标预览
      document.getElementById('linkIcon').addEventListener('input', (e) => {
        const iconPreview = document.getElementById('iconPreview');
        const iconClass = e.target.value.trim();
        
        if (iconClass) {
          iconPreview.className = `fa ${iconClass} text-gray-400`;
        } else {
          iconPreview.className = 'fa fa-link text-gray-400';
        }
      });
      
      // 链接表单提交
      document.getElementById('linkForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const linkData = {
          id: document.getElementById('linkId').value,
          name: document.getElementById('linkName').value,
          url: document.getElementById('linkUrl').value,
          category: document.getElementById('linkCategory').value.trim() || '',
          icon: document.getElementById('linkIcon').value.trim() || ''
        };
        
        // 确保URL以http开头
        if (!linkData.url.startsWith('http://') && !linkData.url.startsWith('https://')) {
          linkData.url = 'https://' + linkData.url;
        }
        
        if (linkData.id) {
          // 更新链接
          await LinkManager.updateLink(linkData);
        } else {
          // 添加新链接
          await LinkManager.addLink(linkData);
        }
        
        // 隐藏模态框并重新渲染
        DOMManager.hideModal('linkModal', 'modalContent');
        const activeCategory = document.querySelector('.category-btn.bg-primary').dataset.category;
        await DOMManager.renderLinks(activeCategory);
        await DOMManager.renderCategories();
      });
      
      // 登录/注册表单提交
      document.getElementById('authForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const email = document.getElementById('authEmail').value;
        const password = document.getElementById('authPassword').value;
        const mode = e.submitter.dataset.mode || 'login';
        
        try {
          if (mode === 'login') {
            await LinkManager.login(email, password);
          } else {
            await LinkManager.register(email, password);
          }
          // 登录/注册成功后自动关闭模态框
          DOMManager.hideModal('authModal', 'authModalContent');
          // 清空表单
          document.getElementById('authForm').reset();
        } catch (error) {
          alert('操作失败：' + error.message);
        }
      });
      
      // 模态框控制
      document.getElementById('addLinkBtn').addEventListener('click', () => {
        DOMManager.openAddModal();
      });
      
      document.getElementById('closeModal').addEventListener('click', () => {
        DOMManager.hideModal('linkModal', 'modalContent');
      });
      
      document.getElementById('cancelBtn').addEventListener('click', () => {
        DOMManager.hideModal('linkModal', 'modalContent');
      });
      
      document.getElementById('userBtn').addEventListener('click', async () => {
        const user = LinkManager.getCurrentUser();
        if (user) {
          // 已登录：执行登出
          if (confirm('确定要登出吗？')) {
            await LinkManager.logout();
          }
        } else {
          // 未登录：打开登录模态框
          DOMManager.showModal('authModal', 'authModalContent');
        }
      });
      
      document.getElementById('closeAuthModal').addEventListener('click', () => {
        DOMManager.hideModal('authModal', 'authModalContent');
      });
      
      document.getElementById('switchAuthMode').addEventListener('click', () => {
        const isLoginMode = document.getElementById('authForm').querySelector('button[type="submit"]').dataset.mode === 'login';
        DOMManager.toggleAuthMode(!isLoginMode);
      });
      
      // 初始化登录模态框为登录模式
      DOMManager.toggleAuthMode(true);
      
      // 点击模态框外部关闭
      document.getElementById('linkModal').addEventListener('click', (e) => {
        if (e.target === document.getElementById('linkModal')) {
          DOMManager.hideModal('linkModal', 'modalContent');
        }
      });
      
      document.getElementById('authModal').addEventListener('click', (e) => {
        if (e.target === document.getElementById('authModal')) {
          DOMManager.hideModal('authModal', 'authModalContent');
        }
      });
      
      // 主题切换
      const toggleThemeBtn = document.getElementById('toggleTheme');
      toggleThemeBtn.addEventListener('click', () => {
        const icon = toggleThemeBtn.querySelector('i');
        
        if (document.body.classList.contains('dark-mode')) {
          icon.classList.remove('fa-sun-o');
          icon.classList.add('fa-moon-o');
          document.body.classList.remove('from-dark', 'to-gray-800', 'text-light', 'dark-mode');
          document.body.classList.add('from-gray-50', 'to-gray-100', 'text-dark');
        } else {
          icon.classList.remove('fa-moon-o');
          icon.classList.add('fa-sun-o');
          document.body.classList.remove('from-gray-50', 'to-gray-100', 'text-dark');
          document.body.classList.add('from-dark', 'to-gray-800', 'text-light', 'dark-mode');
        }
      });
      
      // 滚动时改变导航栏样式
      window.addEventListener('scroll', () => {
        const header = document.querySelector('header');
        if (window.scrollY > 10) {
          header.classList.add('py-2');
          header.classList.remove('py-4');
        } else {
          header.classList.add('py-4');
          header.classList.remove('py-2');
        }
      });
    }
  </script>
</body>
</html>
